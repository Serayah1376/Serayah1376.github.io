<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Pytorchæ·±åº¦å­¦ä¹ å®è·µ</title>
      <link href="/nlp/2021/09/16/pytorch-shen-du-xue-xi-shi-jian/"/>
      <url>/nlp/2021/09/16/pytorch-shen-du-xue-xi-shi-jian/</url>
      
        <content type="html"><![CDATA[<div align="middle"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1854709891&amp;auto=1&amp;height=66"></iframe></div><p><span class="github-emoji"><span>ğŸµ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f3b5.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ä¸Šé¢çš„æ­Œè¶…å¥½å¬å“Ÿ~~~</p><h1 id="PyTorchæ·±åº¦å­¦ä¹ å®è·µ"><a href="#PyTorchæ·±åº¦å­¦ä¹ å®è·µ" class="headerlink" title="PyTorchæ·±åº¦å­¦ä¹ å®è·µ"></a>PyTorchæ·±åº¦å­¦ä¹ å®è·µ</h1><h2 id="çº¿æ€§æ¨¡å‹"><a href="#çº¿æ€§æ¨¡å‹" class="headerlink" title="çº¿æ€§æ¨¡å‹"></a>çº¿æ€§æ¨¡å‹</h2><p>æ•°æ®é›†â€”â€”&gt;æ¨¡å‹è®¾è®¡â€”â€”&gt;è®­ç»ƒâ€”â€”&gt;æ¨ç†<br>è¯„ä¼°æ¨¡å‹å°±ç§°ä¸ºæŸå¤±ï¼Œè®­ç»ƒå°±æ˜¯ä¸ºäº†å°†æŸå¤±é™åˆ°æœ€ä½<br>MSEï¼šå¹³å‡å¹³æ–¹è¯¯å·®<br>çº¿æ€§æ¨¡å‹çš„ä¸€ä¸ªä¾‹å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltx_data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">3.0</span><span class="token punctuation">]</span>y_data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">6.0</span><span class="token punctuation">]</span><span class="token comment">#è®­ç»ƒå‡½æ•°</span><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x<span class="token operator">*</span>w<span class="token keyword">def</span> <span class="token function">loss</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>    y_pred<span class="token operator">=</span>forward<span class="token punctuation">(</span>x<span class="token punctuation">,</span>w<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>y_pred<span class="token operator">-</span>y<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>w_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>mse_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> w <span class="token keyword">in</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">4.1</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'w='</span><span class="token punctuation">,</span>w<span class="token punctuation">)</span>    l_sum<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> x_val<span class="token punctuation">,</span>y_val <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span>y_data<span class="token punctuation">)</span><span class="token punctuation">:</span>        y_pred_val<span class="token operator">=</span>forward<span class="token punctuation">(</span>x_val<span class="token punctuation">,</span>w<span class="token punctuation">)</span>        loss_val<span class="token operator">=</span>loss<span class="token punctuation">(</span>x_val<span class="token punctuation">,</span>y_val<span class="token punctuation">,</span>w<span class="token punctuation">)</span>        l_sum<span class="token operator">+=</span>loss_val        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span>x_val<span class="token punctuation">,</span>y_val<span class="token punctuation">,</span>y_pred_val<span class="token punctuation">,</span>loss_val<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'MSE='</span><span class="token punctuation">,</span>l_sum<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span>    w_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>w<span class="token punctuation">)</span>    mse_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l_sum<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>w_list<span class="token punctuation">,</span>mse_list<span class="token punctuation">)</span>plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Loss'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'w'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¢¯åº¦ä¸‹é™ç®—æ³•"><a href="#æ¢¯åº¦ä¸‹é™ç®—æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™ç®—æ³•"></a>æ¢¯åº¦ä¸‹é™ç®—æ³•</h2><p>éç‚¹ï¼šæ¢¯åº¦ä¸ºé›¶çš„ç‚¹<br>ç”¨åˆ°çš„æ ¸å¿ƒå…¬å¼ï¼š<br>å…¶ä¸­wæ˜¯é€‰æ‹©çš„å‚æ•°ï¼ŒÎ±æ˜¯ä¸€ä¸ªæ¯æ¬¡ä¸‹é™çš„å¤šå°‘ï¼Œåé¢æ˜¯å½“å‰çš„æ¢¯åº¦<br><img src="https://img-blog.csdnimg.cn/1dc9d8394ee042618eb747e311ee5a5e.png" alt="æ¢¯åº¦ä¸‹é™ç®—æ³•"></p><h2 id="åå‘ä¼ æ’­"><a href="#åå‘ä¼ æ’­" class="headerlink" title="åå‘ä¼ æ’­"></a>åå‘ä¼ æ’­</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltx_data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">3.0</span><span class="token punctuation">]</span>y_data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">6.0</span><span class="token punctuation">]</span>w<span class="token operator">=</span><span class="token number">1.0</span><span class="token comment">#è®­ç»ƒå‡½æ•°</span><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x<span class="token operator">*</span>w<span class="token comment">#æŸå¤±å‡½æ•°</span><span class="token keyword">def</span> <span class="token function">cost</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>    cost<span class="token operator">=</span><span class="token number">0.0</span>    <span class="token keyword">for</span> xs<span class="token punctuation">,</span>ys <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>        y_pred<span class="token operator">=</span>forward<span class="token punctuation">(</span>xs<span class="token punctuation">)</span>        cost<span class="token operator">+=</span><span class="token punctuation">(</span>y_pred<span class="token operator">-</span>ys<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>y_pred<span class="token operator">-</span>ys<span class="token punctuation">)</span>    <span class="token keyword">return</span> cost<span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">#ç”¨lenå‡½æ•°å–å¾—åˆ—è¡¨çš„é•¿åº¦</span><span class="token keyword">def</span> <span class="token function">gradient</span><span class="token punctuation">(</span>xs<span class="token punctuation">,</span>ys<span class="token punctuation">)</span><span class="token punctuation">:</span>    grad<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> x<span class="token punctuation">,</span>y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>xs<span class="token punctuation">,</span>ys<span class="token punctuation">)</span><span class="token punctuation">:</span>        grad<span class="token operator">+=</span><span class="token number">2</span><span class="token operator">*</span>x<span class="token operator">*</span><span class="token punctuation">(</span>x<span class="token operator">*</span>w<span class="token operator">-</span>y<span class="token punctuation">)</span>    <span class="token keyword">return</span> grad<span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span>w_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>loss_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Predict(before training'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>forward<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#è¿›è¡Œ100è½®çš„è®­ç»ƒ</span>    cost_val<span class="token operator">=</span>cost<span class="token punctuation">(</span>x_data<span class="token punctuation">,</span>y_data<span class="token punctuation">)</span>    grad_val<span class="token operator">=</span>gradient<span class="token punctuation">(</span>x_data<span class="token punctuation">,</span>y_data<span class="token punctuation">)</span>    w<span class="token operator">-=</span><span class="token number">0.01</span><span class="token operator">*</span>grad_val    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Epoch:'</span><span class="token punctuation">,</span>epoch<span class="token punctuation">,</span><span class="token string">'w='</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token string">'loss='</span><span class="token punctuation">,</span>cost_val<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Predict(after training)'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>forward<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>w_list<span class="token punctuation">,</span>loss_list<span class="token punctuation">)</span>plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Loss'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'w'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token comment">#æ•°æ®é›†</span>x_data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">3.0</span><span class="token punctuation">]</span>y_data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">6.0</span><span class="token punctuation">]</span>w<span class="token operator">=</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#æƒé‡ å¼ é‡ å¼ é‡è®¡ç®—çš„æ—¶å€™ç³»ç»Ÿä¼šæ„å»ºè®¡ç®—å›¾ï¼Œè¦å å†…å­˜</span>w<span class="token punctuation">.</span>require_grad<span class="token operator">=</span><span class="token boolean">True</span> <span class="token comment"># éœ€è¦è®¡ç®—æ¢¯åº¦ï¼Œå¿…é¡»è¦è®¾å®š</span><span class="token comment">#ç›´æ¥ç”¨å¼ é‡ æ„å»ºè®¡ç®—å›¾</span><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> x<span class="token operator">*</span>w  <span class="token comment">#è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªå¼ é‡</span><span class="token comment">#æŸå¤±å‡½æ•°</span><span class="token keyword">def</span> <span class="token function">loss</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>    y_pred<span class="token operator">=</span>forward<span class="token punctuation">(</span>x<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>y_pred<span class="token operator">-</span>y<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Predict(before training):'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>forward<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> x<span class="token punctuation">,</span>y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>x_data<span class="token punctuation">,</span>y_data<span class="token punctuation">)</span><span class="token punctuation">:</span>        l<span class="token operator">=</span>loss<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token comment">#è®¡ç®—æŸå¤±å‡½æ•°4</span>        l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#åå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦  å¹¶æ¸…é™¤è®¡ç®—å›¾</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\tgrad:'</span><span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">.</span>grad<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#æ›´æ–°æƒé‡å€¼</span>        w<span class="token punctuation">.</span>data<span class="token operator">=</span>w<span class="token punctuation">.</span>data<span class="token operator">-</span><span class="token number">0.01</span><span class="token operator">*</span>w<span class="token punctuation">.</span>grad<span class="token punctuation">.</span>data  <span class="token comment">#å°†å€¼å–å‡ºæ¥è®¡ç®—ï¼Œé¿å…ç”Ÿæˆè®¡ç®—å›¾</span>        w<span class="token punctuation">.</span>grad<span class="token punctuation">.</span>data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'progress:'</span><span class="token punctuation">,</span>epoch<span class="token punctuation">,</span>l<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'predict(after training)'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>forward<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç”¨PyTorchå®ç°çº¿æ€§å›å½’"><a href="#ç”¨PyTorchå®ç°çº¿æ€§å›å½’" class="headerlink" title="ç”¨PyTorchå®ç°çº¿æ€§å›å½’"></a>ç”¨PyTorchå®ç°çº¿æ€§å›å½’</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token comment">#å°†æ•°æ®åˆå§‹åŒ–ä¸ºå¼ é‡</span>x_data<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y_data<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">LinearModel</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>linear<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>        y_pred<span class="token operator">=</span>self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">return</span> y_pred    model<span class="token operator">=</span>LinearModel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># æ¨¡å‹</span><span class="token comment">#æ„é€ æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span>criterion<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span>size_average<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment">#æŸå¤±å‡½æ•°</span>optimizer<span class="token operator">=</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>  <span class="token comment">#ä¼˜åŒ–å™¨</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    y_pred<span class="token operator">=</span>model<span class="token punctuation">(</span>x_data<span class="token punctuation">)</span>    loss<span class="token operator">=</span>criterion<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span>y_data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>epoch<span class="token punctuation">,</span>loss<span class="token punctuation">)</span>        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#åé¦ˆä¹‹å‰å°†ä¹‹å‰çš„æ¢¯åº¦æ¸…ç©º</span>    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#åé¦ˆ</span>    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># æ›´æ–°æƒé‡</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'w='</span><span class="token punctuation">,</span>model<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b='</span><span class="token punctuation">,</span>model<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#Test Model</span>x_test<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y_test<span class="token operator">=</span>model<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'y_pred='</span><span class="token punctuation">,</span>y_test<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é€»è¾‘æ–¯è’‚å›å½’ï¼ˆç”¨äºåˆ†ç±»ï¼‰"><a href="#é€»è¾‘æ–¯è’‚å›å½’ï¼ˆç”¨äºåˆ†ç±»ï¼‰" class="headerlink" title="é€»è¾‘æ–¯è’‚å›å½’ï¼ˆç”¨äºåˆ†ç±»ï¼‰"></a>é€»è¾‘æ–¯è’‚å›å½’ï¼ˆç”¨äºåˆ†ç±»ï¼‰</h2><p>è¦æ‰¾ä¸€ä¸ªå‡½æ•°ï¼Œå°†åŸæ¥çš„è¾“å‡ºå¯¹åº”åˆ°è§„å®šçš„èŒƒå›´å†…ï¼Œæ¯”å¦‚[0ï¼Œ1]ï¼Œå³é¥±å’Œå‡½æ•°<br>é¥±å’Œå‡½æ•°ä¸­æœ€æœ‰ä»£è¡¨æ€§çš„æ—¶é€»è¾‘æ–¯è’‚å‡½æ•°ï¼ˆè¥¿æ ¼ç›ï¼‰<br>æŸå¤±å‡½æ•°ä¹Ÿè¦æœ‰ç›¸åº”çš„å˜åŒ–</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F<span class="token comment">#ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ®</span>x_data<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y_data<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># åˆ†ä¸ºä¸‰ä¸ªç±»åˆ«</span><span class="token comment">#ç¬¬äºŒæ­¥ï¼šè®¾è®¡æ¨¡å‹</span><span class="token keyword">class</span> <span class="token class-name">LogisticRegressionModel</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>linear<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>        y_pred<span class="token operator">=</span>F<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#æ·»åŠ é€»è¾‘æ–¯è’‚å‡½æ•°</span>        <span class="token keyword">return</span> y_predmodel<span class="token operator">=</span>LogisticRegressionModel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># æ¨¡å‹</span><span class="token comment">#ç¬¬ä¸‰æ­¥ï¼šæ„é€ æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span>criterion<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>BCELoss<span class="token punctuation">(</span>size_average<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment">#æŸå¤±å‡½æ•°</span>optimizer<span class="token operator">=</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>  <span class="token comment">#ä¼˜åŒ–å™¨</span><span class="token comment">#ç¬¬å››æ­¥ï¼šè®­ç»ƒ</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    y_pred<span class="token operator">=</span>model<span class="token punctuation">(</span>x_data<span class="token punctuation">)</span> <span class="token comment">#ä¼°è®¡å€¼</span>    loss<span class="token operator">=</span>criterion<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span>y_data<span class="token punctuation">)</span>  <span class="token comment">#æŸå¤±å€¼</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>epoch<span class="token punctuation">,</span>loss<span class="token punctuation">)</span>        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#åé¦ˆä¹‹å‰å°†ä¹‹å‰çš„æ¢¯åº¦æ¸…ç©º</span>    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#åé¦ˆ</span>    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># æ›´æ–°æƒé‡</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'w='</span><span class="token punctuation">,</span>model<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b='</span><span class="token punctuation">,</span>model<span class="token punctuation">.</span>linear<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#Test Model</span>x_test<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y_test<span class="token operator">=</span>model<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'y_pred='</span><span class="token punctuation">,</span>y_test<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤„ç†å¤šç»´ç‰¹å¾è¾“å…¥"><a href="#å¤„ç†å¤šç»´ç‰¹å¾è¾“å…¥" class="headerlink" title="å¤„ç†å¤šç»´ç‰¹å¾è¾“å…¥"></a>å¤„ç†å¤šç»´ç‰¹å¾è¾“å…¥</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token comment">#ç¬¬ä¸€æ­¥ å‡†æœ¬æ•°æ®</span>xy<span class="token operator">=</span>np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'diabetes.csv.gz'</span><span class="token punctuation">,</span>delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token comment">#åˆ†éš”ç¬¦æ˜¯é€—å·</span>x_data<span class="token operator">=</span>torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>xy<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y_data<span class="token operator">=</span>torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>xy<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#å¦‚æœ-1ä¸åŠ ä¸­æ‹¬å·çš„è¯ï¼Œå‡ºæ¥çš„æ˜¯ä¸€ä¸ªå‘é‡</span><span class="token comment">#ç¬¬äºŒæ­¥ï¼šè®¾è®¡ç›¸å…³æ¨¡å‹</span><span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">#æ¢¯åº¦ä¸‹é™</span>        self<span class="token punctuation">.</span>linear1<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>linear2<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>linear3<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sigmoid<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#éçº¿æ€§å‡½æ•°  æ²¡æœ‰å‚æ•°</span>        <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># å‰å‘ä¼ æ’­å‡½æ•°</span>        x<span class="token operator">=</span>self<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>linear1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        x<span class="token operator">=</span>self<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>linear2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        x<span class="token operator">=</span>self<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>linear3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> xmodel<span class="token operator">=</span>Model<span class="token comment">#ç¬¬ä¸‰æ­¥ï¼šä¼˜åŒ–å’ŒæŸå¤±å‡½æ•°</span>criterion<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>BCELoss<span class="token punctuation">(</span>size_average<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>optimizer<span class="token operator">=</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lr<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token comment">#ç¬¬å››æ­¥ï¼šè®­ç»ƒ</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment">#å‰é¦ˆ</span>    y_pred<span class="token operator">=</span>model<span class="token punctuation">(</span>x_data<span class="token punctuation">)</span>    loss<span class="token operator">=</span>criterion<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span>y_data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>epoch<span class="token punctuation">,</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#åé¦ˆ</span>    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">#æ›´æ–°</span>    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¿€æ´»å‡½æ•°çš„ä½œç”¨ï¼šåŠ å…¥éçº¿æ€§å› ç´ ï¼Œè§£å†³çº¿æ€§æ¨¡å‹ä¸èƒ½è§£å†³çš„é—®é¢˜ï¼›å¦‚æœä¸ç”¨æ¿€æ´»å‡½æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ¯ä¸€å±‚è¾“å‡ºéƒ½æ˜¯ä¸Šå±‚éƒ½æ˜¯ä¸Šå±‚è¾“å…¥çš„çº¿æ€§å‡½æ•°ã€‚å®¹æ˜“éªŒè¯ï¼Œæ— è®ºç¥ç»ç½‘ç»œæœ‰å¤šå°‘å±‚ï¼Œè¾“å‡ºéƒ½æ˜¯è¾“å…¥çš„çº¿æ€§ç»„åˆï¼Œä¸æ²¡æœ‰éšè—å±‚æ•ˆæœç›¸å½“ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯æœ€åŸå§‹çš„æ„ŸçŸ¥æœºäº†ã€‚å› æ­¤å¼•å…¥éçº¿æ€§å‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œè¿™æ ·æ·±å±‚ç¥ç»ç½‘ç»œå°±æœ‰æ„ä¹‰äº†ã€‚</p><h2 id="å¤šåˆ†ç±»é—®é¢˜"><a href="#å¤šåˆ†ç±»é—®é¢˜" class="headerlink" title="å¤šåˆ†ç±»é—®é¢˜"></a>å¤šåˆ†ç±»é—®é¢˜</h2><p>MNISTæ‰‹å†™æ•°æ®é›†åˆ†ç±»</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch <span class="token comment">#ç”¨äºæ„å»ºæ•°æ®é›†</span><span class="token keyword">from</span> torchvision <span class="token keyword">import</span> transforms<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> datasets<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader<span class="token comment">#æ¿€æ´»å‡½æ•°relu()</span><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F<span class="token comment">#ä¼˜åŒ–å™¨</span><span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim<span class="token comment">#æ•°æ®é›†çš„å‡†å¤‡</span><span class="token comment">#ç¥ç»ç½‘ç»œå¸Œæœ›è¾“å…¥çš„æ•°æ®å°½å¯èƒ½çš„å°ï¼Œå°½é‡åœ¨0åˆ°1ä¹‹é—´</span>batch_size<span class="token operator">=</span><span class="token number">64</span>transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>    transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#å˜æ¢ç»´åº¦ï¼Œç”±å•é€šé“å˜ä¸ºå¤šé€šé“</span>    transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.1307</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0.3081</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#å‡å€¼å’Œæ ‡å‡†å·®  åˆ‡æ¢åˆ°0,1åˆ†å¸ƒ</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>train_dataset<span class="token operator">=</span>datasets<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'../dataset/minist'</span><span class="token punctuation">,</span>                            train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                            download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                            transform<span class="token operator">=</span>transform<span class="token punctuation">)</span>train_loader<span class="token operator">=</span>DataLoader<span class="token punctuation">(</span>train_dataset<span class="token punctuation">,</span>                        shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                        batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">)</span>test_dataset<span class="token operator">=</span>datasets<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'../dataset/minist'</span><span class="token punctuation">,</span>                            train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                            download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                            transform<span class="token operator">=</span>transform<span class="token punctuation">)</span>test_loader<span class="token operator">=</span>DataLoader<span class="token punctuation">(</span>test_dataset<span class="token punctuation">,</span>                       shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                       batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">)</span><span class="token comment">#è®¾è®¡æ¨¡å‹</span><span class="token comment">#å…¨è¿æ¥ç¥ç»ç½‘ç»œè¾“å…¥çš„æ ·æœ¬è¦æ±‚æ˜¯1é˜¶çš„å‘é‡</span><span class="token keyword">class</span> <span class="token class-name">Net</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>l1<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">784</span><span class="token punctuation">,</span><span class="token number">512</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>l2<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>l3<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>l4<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>l5<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>            <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>        x<span class="token operator">=</span>x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">784</span><span class="token punctuation">)</span>        x<span class="token operator">=</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>l1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        x<span class="token operator">=</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>l2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        x<span class="token operator">=</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>l3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        x<span class="token operator">=</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>l4<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        x<span class="token operator">=</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>l5<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> xmodel<span class="token operator">=</span>Net<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">#æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span>criterion<span class="token operator">=</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#äº¤å‰ç†µæŸå¤±å‡½æ•°</span>optimizer<span class="token operator">=</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>momentum<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token comment">#è®­ç»ƒ</span><span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token punctuation">:</span>    running_loss<span class="token operator">=</span><span class="token number">0.0</span>    <span class="token keyword">for</span> batch_idx<span class="token punctuation">,</span>data <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        inputs<span class="token punctuation">,</span>target<span class="token operator">=</span>data        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">#å‰å‘ä¼ æ’­</span>        outputs<span class="token operator">=</span>model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>        <span class="token comment">#è®¡ç®—æŸå¤±å€¼</span>        loss<span class="token operator">=</span>criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span>target<span class="token punctuation">)</span>        <span class="token comment">#åå‘ä¼ æ’­</span>        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">#æ›´æ–°</span>        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>                running_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> batch_idx<span class="token operator">%</span><span class="token number">300</span><span class="token operator">==</span><span class="token number">299</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[%d,%5d]loss"%.3f'</span><span class="token operator">%</span><span class="token punctuation">(</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>batch_idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>running_loss<span class="token operator">/</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            running_loss<span class="token operator">=</span><span class="token number">0.0</span><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    correct<span class="token operator">=</span><span class="token number">0</span>    total<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#ä¸éœ€è¦æ¢¯åº¦</span>        <span class="token keyword">for</span> data <span class="token keyword">in</span> test_loader<span class="token punctuation">:</span>            images<span class="token punctuation">,</span>labels<span class="token operator">=</span>data            outputs<span class="token operator">=</span>model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>            _<span class="token punctuation">,</span>predicted<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>data<span class="token punctuation">,</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">#å–å‡ºæ¯ä¸€è¡Œæœ€å¤§å€¼çš„ä¸‹æ ‡</span>            total<span class="token operator">+=</span>labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            correct<span class="token operator">+=</span><span class="token punctuation">(</span>predicted<span class="token operator">==</span>labels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#è·å¾—çŒœå¯¹çš„æ•°é‡</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'çŒœå¯¹çš„æ¯”ç‡æ˜¯ï¼š%d %%'</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">*</span>correct<span class="token operator">/</span>total<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        train<span class="token punctuation">(</span>epoch<span class="token punctuation">)</span>        test<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nlp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>First</title>
      <link href="/uncategorized/2021/09/16/first/"/>
      <url>/uncategorized/2021/09/16/first/</url>
      
        <content type="html"><![CDATA[<p><del>èœå¾—ä¸çŸ¥æ‰€æª</del></p><div align="middle"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1499527753&amp;auto=1&amp;height=66"></iframe></div>]]></content>
      
      
      
        <tags>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/uncategorized/2021/09/16/hello-world/"/>
      <url>/uncategorized/2021/09/16/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>  <div align="middle"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1854709891&amp;auto=1&amp;height=66"></iframe></div>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
